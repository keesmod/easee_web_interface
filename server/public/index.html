<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Easee EV Charger Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  </head>
  <body class="bg-gradient-to-b from-slate-900 to-slate-950 text-slate-50" style="font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'">
    <header class="border-b border-white/10 bg-slate-900/50 backdrop-blur supports-backdrop-blur:backdrop-blur sticky top-0 z-10">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
        <div class="text-xl font-bold">⚡ Easee EV Charger</div>
        <div class="ml-auto flex items-center gap-2">
          <button id="logout" class="hidden px-3 py-1.5 rounded-md bg-slate-700 hover:bg-slate-600 text-sm">Logout</button>
          <select id="themeSelect" class="px-2 py-1 rounded-md bg-slate-800 border border-white/10 text-sm">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
          </select>
          <select id="unitsSelect" class="px-2 py-1 rounded-md bg-slate-800 border border-white/10 text-sm">
            <option value="metric">Units: Metric</option>
            <option value="imperial">Units: Imperial</option>
          </select>
          <select id="currencySelect" class="px-2 py-1 rounded-md bg-slate-800 border border-white/10 text-sm">
            <option value="USD">$ USD</option>
            <option value="EUR">€ EUR</option>
            <option value="GBP">£ GBP</option>
            <option value="NOK">kr NOK</option>
          </select>
          <select id="transportSelect" class="px-2 py-1 rounded-md bg-slate-800 border border-white/10 text-sm">
            <option value="sse">Live: SSE</option>
            <option value="poll">Live: Poll</option>
          </select>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-6">
      <!-- Login Panel -->
      <section id="login-section" class="grid md:grid-cols-2 gap-6">
        <div class="col-span-1">
          <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
            <h2 class="text-lg font-semibold mb-4">Login</h2>
            <form id="login-form" class="space-y-3">
              <div>
                <label class="block text-sm mb-1">Username (email or phone)</label>
                <input id="username" type="text" class="w-full px-3 py-2 rounded-lg bg-slate-900/70 border border-white/10 focus:outline-none focus:ring-2 focus:ring-sky-500" required>
              </div>
              <div>
                <label class="block text-sm mb-1">Password</label>
                <input id="password" type="password" class="w-full px-3 py-2 rounded-lg bg-slate-900/70 border border-white/10 focus:outline-none focus:ring-2 focus:ring-sky-500" required>
              </div>
              <div class="flex items-center gap-3">
                <button type="submit" class="px-4 py-2 rounded-lg bg-sky-500 text-slate-900 font-semibold hover:bg-sky-400">Login</button>
                <div id="login-message" class="text-slate-300 text-sm"></div>
              </div>
            </form>
          </div>
        </div>
        <div class="hidden md:block"></div>
      </section>

      <!-- Dashboard -->
      <section id="dashboard" class="hidden space-y-6">
        <!-- Controls row -->
        <div class="grid lg:grid-cols-3 gap-6">
          <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
            <div class="text-sm text-slate-300 mb-2">Charger</div>
            <div class="flex flex-col md:flex-row gap-3">
              <select id="chargerSelect" class="flex-1 px-3 py-2 rounded-lg bg-slate-900/70 border border-white/10 focus:outline-none focus:ring-2 focus:ring-sky-500">
                <option value="">Select your charger…</option>
              </select>
              <input id="chargerId" placeholder="or enter ID" class="flex-1 px-3 py-2 rounded-lg bg-slate-900/70 border border-white/10 focus:outline-none"/>
            </div>
          </div>
          <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-slate-300">Charging Current</div>
              <div class="text-sm"><span id="currentValue">—</span> A</div>
            </div>
            <input id="currentSlider" type="range" min="1" max="32" value="16" class="w-full">
            <div class="mt-3 flex gap-2">
              <button id="applyCurrentBtn" class="px-3 py-1.5 rounded-md bg-sky-500 text-slate-900 font-semibold hover:bg-sky-400">Apply</button>
              <button id="pauseBtn" class="px-3 py-1.5 rounded-md bg-amber-400 text-slate-900 font-semibold hover:bg-amber-300">Pause</button>
              <button id="resumeBtn" class="px-3 py-1.5 rounded-md bg-emerald-400 text-slate-900 font-semibold hover:bg-emerald-300">Resume</button>
            </div>
          </div>
          <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl flex items-center justify-center">
            <div class="text-center">
              <div class="text-slate-300 text-sm mb-1">Power</div>
              <div class="text-5xl md:text-6xl font-extrabold" id="powerDisplay">—</div>
              <div class="text-slate-300">kW</div>
            </div>
          </div>
        </div>

        <!-- Chart -->
        <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">Live Charging Data</div>
            <div class="text-sm text-slate-300">Window: last 5 min</div>
          </div>
          <canvas id="liveChart" height="120"></canvas>
        </div>

        <!-- Info cards -->
        <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
            <div class="text-slate-300 text-sm">Session Time</div>
            <div id="sessionTime" class="text-2xl font-semibold">—</div>
          </div>
          <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
            <div class="text-slate-300 text-sm">Session Energy</div>
            <div id="sessionEnergy" class="text-2xl font-semibold">— kWh</div>
          </div>
          <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
            <div class="text-slate-300 text-sm">Session Cost</div>
            <div id="sessionCost" class="text-2xl font-semibold">—</div>
          </div>
          <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
            <div class="text-slate-300 text-sm">Total Energy</div>
            <div id="totalEnergy" class="text-2xl font-semibold">— kWh</div>
          </div>
        </div>

        <!-- Raw JSON (collapsible) -->
        <details class="rounded-2xl bg-slate-800/60 border border-white/10 p-4 shadow">
          <summary class="cursor-pointer text-sm text-slate-300">Live JSON</summary>
          <pre id="liveData" class="text-xs mt-3 whitespace-pre-wrap"></pre>
        </details>

        <!-- Last 24h -->
        <div class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">Last 24 hours</div>
            <div class="text-sm text-slate-300">Per-session energy</div>
          </div>
          <canvas id="historyChart" height="100"></canvas>
          <div id="historyData" class="text-slate-200 mt-4"></div>
        </div>

        <!-- Overview of all chargers -->
        <details class="rounded-2xl bg-slate-800/60 border border-white/10 p-6 shadow-xl">
          <summary class="cursor-pointer font-semibold">All chargers overview</summary>
          <div class="mt-4" id="overview">
            <div class="text-sm text-slate-300">Click "Load Overview" to fetch current status of all chargers.</div>
            <button id="loadOverviewBtn" class="mt-3 px-3 py-1.5 rounded-md bg-slate-700 hover:bg-slate-600 text-sm">Load Overview</button>
            <div id="overviewGrid" class="mt-4 grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
          </div>
        </details>
      </section>
    </main>

    <script src="/main.js"></script>
    <script>
      (function(){
        const themeSelect = document.getElementById('themeSelect');
        const transportSelect = document.getElementById('transportSelect');
        function syncSelects(){
          try{
            const prefs = JSON.parse(localStorage.getItem('easee_prefs')||'{}');
            if (prefs.theme) themeSelect.value = prefs.theme;
            if (prefs.liveTransport) transportSelect.value = prefs.liveTransport;
          }catch{}
        }
        syncSelects();
        themeSelect?.addEventListener('change',()=>{
          try{
            const prefs = JSON.parse(localStorage.getItem('easee_prefs')||'{}');
            prefs.theme = themeSelect.value;
            localStorage.setItem('easee_prefs', JSON.stringify(prefs));
          }catch{}
          if (window.applyTheme) window.applyTheme(themeSelect.value);
        });
        transportSelect?.addEventListener('change',()=>{
          try{
            const prefs = JSON.parse(localStorage.getItem('easee_prefs')||'{}');
            prefs.liveTransport = transportSelect.value;
            localStorage.setItem('easee_prefs', JSON.stringify(prefs));
          }catch{}
        });
      })();
    </script>
  </body>
  </html>


